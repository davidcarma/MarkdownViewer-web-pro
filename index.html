<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Editor</title>
    <link rel="stylesheet" href="highlight.min.css">
    <!-- Modular CSS -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/buttons.css">
    <link rel="stylesheet" href="css/toolbar.css">
    <link rel="stylesheet" href="css/editor.css">
    <link rel="stylesheet" href="css/preview.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="app">
        <!-- Header with toolbar -->
        <header class="toolbar">
            <div class="toolbar-section">
                <div class="app-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14,2 14,8 20,8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10,9 9,9 8,9"></polyline>
                    </svg>
                    <input type="text" id="documentTitle" class="document-title-input" value="Untitled.md" placeholder="Document name" spellcheck="false" autocomplete="off">
                </div>
            </div>
            
            <div class="toolbar-section toolbar-actions">
                <button class="btn btn-icon" id="newFile" title="New File">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14,2 14,8 20,8"></polyline>
                    </svg>
                </button>
                
                <button class="btn btn-icon" id="openFile" title="Open File">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 7v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-6l-2-2H5a2 2 0 0 0-2 2z"></path>
                    </svg>
                </button>
                
                <button class="btn btn-icon" id="openWordFile" title="Import Word Document">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14,2 14,8 20,8"></polyline>
                        <text x="12" y="16" font-family="Arial, sans-serif" font-size="5" font-weight="bold" text-anchor="middle" fill="currentColor">W</text>
                    </svg>
                </button>
                
                <button class="btn btn-icon" id="saveFile" title="Save File">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17,21 17,13 7,13 7,21"></polyline>
                        <polyline points="7,3 7,8 15,8"></polyline>
                    </svg>
                </button>
                
                <button class="btn btn-icon btn-pdf-export" id="exportToPdf" title="Export to PDF">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14,2 14,8 20,8"></polyline>
                        <text x="12" y="16" font-family="Arial, sans-serif" font-size="6" font-weight="bold" text-anchor="middle" fill="currentColor">PDF</text>
                    </svg>
                </button>
                
                <button class="btn btn-icon" id="printFile" title="Print">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6,9 6,2 18,2 18,9"></polyline>
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                        <polyline points="6,14 18,14 18,22 6,22 6,14"></polyline>
                    </svg>
                </button>
                
                <div class="separator"></div>
                
                <button class="btn btn-icon" id="togglePreview" title="Toggle Preview">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                </button>
                
                <button class="btn btn-icon" id="toggleTheme" title="Toggle Theme">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Format toolbar -->
        <div class="format-toolbar">
            <div class="format-group">
                <button class="btn btn-format" data-format="bold" title="Bold (Ctrl+B)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
                        <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
                    </svg>
                </button>
                <button class="btn btn-format" data-format="italic" title="Italic (Ctrl+I)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="4" x2="10" y2="4"></line>
                        <line x1="14" y1="20" x2="5" y2="20"></line>
                        <line x1="15" y1="4" x2="9" y2="20"></line>
                    </svg>
                </button>
                <button class="btn btn-format" data-format="code" title="Inline Code">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="16,18 22,12 16,6"></polyline>
                        <polyline points="8,6 2,12 8,18"></polyline>
                    </svg>
                </button>
            </div>
            
            <div class="format-group">
                <button class="btn btn-format" data-format="h1" title="Heading 1">H1</button>
                <button class="btn btn-format" data-format="h2" title="Heading 2">H2</button>
                <button class="btn btn-format" data-format="h3" title="Heading 3">H3</button>
            </div>
            
            <div class="format-group">
                <button class="btn btn-format" data-format="ul" title="Bullet List">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="8" y1="6" x2="21" y2="6"></line>
                        <line x1="8" y1="12" x2="21" y2="12"></line>
                        <line x1="8" y1="18" x2="21" y2="18"></line>
                        <line x1="3" y1="6" x2="3.01" y2="6"></line>
                        <line x1="3" y1="12" x2="3.01" y2="12"></line>
                        <line x1="3" y1="18" x2="3.01" y2="18"></line>
                    </svg>
                </button>
                <button class="btn btn-format" data-format="ol" title="Numbered List">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="10" y1="6" x2="21" y2="6"></line>
                        <line x1="10" y1="12" x2="21" y2="12"></line>
                        <line x1="10" y1="18" x2="21" y2="18"></line>
                        <path d="M4 6h1v4"></path>
                        <path d="M4 10h2"></path>
                        <path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"></path>
                    </svg>
                </button>
                <button class="btn btn-format" data-format="quote" title="Quote">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z"></path>
                        <path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z"></path>
                    </svg>
                </button>
            </div>
            
            <div class="format-group">
                <button class="btn btn-format" data-format="link" title="Link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                </button>
                <button class="btn btn-format" data-format="image" title="Image">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21,15 16,10 5,21"></polyline>
                    </svg>
                </button>
                <button class="btn btn-format" id="insertImage" title="Insert Image/SVG File">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21,15 16,10 5,21"></polyline>
                        <line x1="12" y1="8" x2="12" y2="16"></line>
                        <line x1="8" y1="12" x2="16" y2="12"></line>
                    </svg>
                </button>
                <button class="btn btn-format" data-format="table" title="Table">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18"></path>
                    </svg>
                </button>
                <button class="btn btn-format" data-format="mermaid" title="Mermaid Diagram">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                        <polyline points="7.5,10 12,15 16.5,10"></polyline>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Main content area -->
        <main class="main-content">
            <!-- File input for opening files -->
            <input type="file" id="fileInput" accept=".md,.txt" style="display: none;">
            
            <!-- Word document input for importing Word files -->
            <input type="file" id="wordFileInput" accept=".docx" style="display: none;">
            
            <!-- Image/SVG input for inserting images -->
            <input type="file" id="imageInput" accept="image/*,.svg" style="display: none;" multiple>
            
            <!-- Editor and preview panes -->
            <div class="editor-container">
                <div class="pane editor-pane">
                    <div class="pane-header">
                        <span class="pane-title">Editor</span>
                        <div class="editor-info">
                            <span id="lineCount">Lines: 1</span>
                            <span id="wordCount">Words: 0</span>
                            <span id="charCount">Characters: 0</span>
                        </div>
                    </div>
                    <textarea id="editor" placeholder="Start typing your markdown here..."></textarea>
                </div>
                
                <div class="pane-divider"></div>
                
                <div class="pane preview-pane">
                    <div class="pane-header">
                        <span class="pane-title">Preview</span>
                        <button class="btn btn-sm" id="copyHtml" title="Copy HTML">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Copy HTML
                        </button>
                    </div>
                    <div id="preview" class="preview-content"></div>
                </div>
            </div>
        </main>

        <!-- Status bar -->
        <footer class="status-bar">
            <div class="status-left">
                <span id="fileName">Untitled.md</span>
                <span id="fileStatus" class="file-status">●</span>
            </div>
            <div class="status-right">
                <span id="cursorPosition">Line 1, Column 1</span>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="marked.min.js"></script>
    <script src="highlight.min.js"></script>
    <script src="mermaid.min.js"></script>
    <script src="mammoth.js"></script>
    <script>
        // Debug mammoth.js loading with detailed information
        console.log('=== MAMMOTH.JS DEBUG INFO ===');
        console.log('Window object keys:', Object.keys(window).filter(k => k.toLowerCase().includes('mammoth')));
        console.log('Global mammoth available:', typeof mammoth !== 'undefined');
        if (typeof mammoth !== 'undefined') {
            console.log('✅ mammoth.js loaded successfully');
            console.log('Mammoth object:', mammoth);
            console.log('Available methods:', Object.keys(mammoth));
        } else {
            console.error('❌ mammoth.js failed to load - checking for alternatives');
            console.log('All global variables containing "mammoth":', Object.keys(window).filter(k => k.toString().toLowerCase().includes('mammoth')));
            
            // Check if the UMD wrapper might have put it somewhere else
            if (typeof module !== 'undefined' && module.exports) {
                console.log('Module system detected:', typeof module.exports);
            }
            
            // Try to access it in a few common places
            const alternatives = [
                window.mammoth,
                window.Mammoth,
                window.MAMMOTH,
                global && global.mammoth,
                self && self.mammoth
            ];
            
            alternatives.forEach((alt, index) => {
                console.log(`Alternative ${index}:`, typeof alt, alt);
            });
        }
        console.log('=== END MAMMOTH DEBUG ===');
        
        // If mammoth still isn't available, try to fix it
        if (typeof mammoth === 'undefined') {
            console.log('🔧 Attempting to fix mammoth availability...');
            
            // Try to manually trigger the UMD wrapper again
            setTimeout(() => {
                console.log('Rechecking mammoth after timeout...');
                if (typeof mammoth !== 'undefined') {
                    console.log('✅ mammoth became available after timeout');
                } else {
                    console.log('❌ mammoth still not available after timeout');
                    
                    // Try alternative CDN as fallback
                    const script = document.createElement('script');
                    script.src = 'https://unpkg.com/mammoth@1.10.0/lib/mammoth.browser.min.js';
                    script.onload = () => console.log('✅ CDN fallback loaded');
                    script.onerror = () => console.error('❌ CDN fallback failed');
                    document.head.appendChild(script);
                }
            }, 100);
        }
    </script>
    <!-- Modular JavaScript -->
    <script src="js/storage-manager.js"></script>
    <script src="js/core.js"></script>
    <script src="js/events.js"></script>
    <script src="js/file-operations.js"></script>
    <script src="js/drag-drop.js"></script>
    <script src="js/image-paste.js"></script>
    <script src="js/simple-image-collapse-v2.js"></script>
    <script src="js/syntax-highlight.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/pane-resizer.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
